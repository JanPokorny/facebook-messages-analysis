# coding=utf-8
from datetime import datetime

"""
Some aggregating functions imported using relfections
"""

"""
AGGREGATORS
Return a dict with some calculated properties. All dicts are combined to form the result.
They are automatically called for "me" and "other" separately. The corresponding postfixes are added automatically.
"""

def aggregator_count(msgs):
    """
    Counts things.
    """
    msg_count = len(msgs)
    word_count = sum(len(msg['text'].split()) for msg in msgs)
    char_count = sum(len(msg['text']) for msg in msgs)
    return {
        'msg_count': msg_count,
        'word_count': word_count,
        'char_count': char_count,
        'words_per_msg': word_count / msg_count,
        'chars_per_msg': char_count / msg_count,
        'chars_per_word': char_count / word_count
    }


def aggregator_active_hours(msgs):
    """
    Counts messages by hour they were sent in
    """
    hours = [0]*24
    for msg in msgs:
        hours[datetime.fromtimestamp(msg['date']).hour] += 1
    return {
        'active_hours': hours
    }


smileys = [
    "ğŸ˜‚", "ğŸ˜€", "ğŸ˜¬", "ğŸ˜", "ğŸ˜‚", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†", "ğŸ˜‡", "ğŸ˜‰", "ğŸ˜Š", "ğŸ™‚", "ğŸ™ƒ", "â˜ºï¸", "ğŸ˜‹", "ğŸ˜Œ", "ğŸ˜", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜™", "ğŸ˜š", "ğŸ˜œ", "ğŸ˜", "ğŸ˜›", "ğŸ¤‘", "ğŸ¤“", "ğŸ˜", "ğŸ¤—", "ğŸ˜", "ğŸ˜¶", "ğŸ˜", "ğŸ˜‘", "ğŸ˜’", "ğŸ™„", "ğŸ¤”", "ğŸ˜³", "ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜ ", "ğŸ˜¡", "ğŸ˜”", "ğŸ˜•", "ğŸ™", "â˜¹ï¸", "ğŸ˜£", "ğŸ˜–", "ğŸ˜«", "ğŸ˜©", "ğŸ˜¤", "ğŸ˜®", "ğŸ˜±", "ğŸ˜¨", "ğŸ˜°", "ğŸ˜¯", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¢", "ğŸ˜¥", "ğŸ˜ª", "ğŸ˜“", "ğŸ˜­", "ğŸ˜µ", "ğŸ˜²", "ğŸ¤", "ğŸ˜·", "ğŸ¤’", "ğŸ¤•", "ğŸ˜´", "ğŸ’¤", "ğŸ’©", "ğŸ˜ˆ", "ğŸ‘¿", "ğŸ‘¹", "ğŸ‘º", "ğŸ’€", "ğŸ‘»", "ğŸ‘½", "ğŸ¤–", "ğŸ˜º", "ğŸ˜¸", "ğŸ˜¹", "ğŸ˜»", "ğŸ˜¼", "ğŸ˜½", "ğŸ™€", "ğŸ˜¿", "ğŸ˜¾", "ğŸ™Œ", "ğŸ‘", "ğŸ‘‹", "ğŸ‘", "ğŸ‘Š", "âœŠ", "âœŒï¸", "ğŸ‘Œ", "âœ‹", "ğŸ’ª", "ğŸ™", "â˜ï¸", "ğŸ‘†", "ğŸ‘‡", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ–•", "ğŸ¤˜", "ğŸ––", "âœï¸", "ğŸ’…", "ğŸ‘„", "ğŸ‘…", "ğŸ‘‚", "ğŸ‘ƒ", "ğŸ‘", "ğŸ‘€", "ğŸ‘¤", "ğŸ—£", "ğŸ‘¶", "ğŸ‘¦", "ğŸ‘§", "ğŸ‘¨", "ğŸ‘©", "ğŸ‘±", "ğŸ‘´", "ğŸ‘µ", "ğŸ‘²", "ğŸ‘³", "ğŸ‘®", "ğŸ‘·", "ğŸ’‚", "ğŸ•µ", "ğŸ…", "ğŸ‘¼", "ğŸ‘¸", "ğŸ‘°", "ğŸš¶", "ğŸƒ", "ğŸ’ƒ", "ğŸ‘¯", "ğŸ‘«", "ğŸ‘¬", "ğŸ‘­", "ğŸ™‡", "ğŸ’", "ğŸ™…", "ğŸ™†", "ğŸ™‹", "ğŸ™", "ğŸ™", "ğŸ’‡", "ğŸ’†", "ğŸ’‘", "ğŸ‘©â€â¤ï¸â€ğŸ‘©", "ğŸ‘¨â€â¤ï¸â€ğŸ‘¨", "ğŸ’", "ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©", "ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨", "ğŸ‘ª", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§", "ğŸ‘©â€ğŸ‘©â€ğŸ‘¦", "ğŸ‘©â€ğŸ‘©â€ğŸ‘§", "ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦", "ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§", "ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦", "ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§", "ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦", "ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦", "ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§", "ğŸ‘š", "ğŸ‘•", "ğŸ‘–", "ğŸ‘”", "ğŸ‘—", "ğŸ‘™", "ğŸ‘˜", "ğŸ’„", "ğŸ’‹", "ğŸ‘£", "ğŸ‘ ", "ğŸ‘¡", "ğŸ‘¢", "ğŸ‘", "ğŸ‘Ÿ", "ğŸ‘’", "ğŸ©", "â›‘", "ğŸ“", "ğŸ‘‘", "ğŸ’", "ğŸ‘", "ğŸ‘›", "ğŸ‘œ", "ğŸ’¼", "ğŸ‘“", "ğŸ•¶", "ğŸ’", "ğŸŒ‚ğŸ‘´ğŸ»", "ğŸ‘µğŸ»", "ğŸ‘¶ğŸ»", "ğŸ‘±ğŸ»", "ğŸ‘®ğŸ»", "ğŸ‘²ğŸ»", "ğŸ‘³ğŸ»", "ğŸ‘·ğŸ»", "ğŸ‘¸ğŸ»", "ğŸ’‚ğŸ»", "ğŸ…ğŸ»", "ğŸ‘¼ğŸ»", "ğŸ’†ğŸ»", "ğŸ’‡ğŸ»", "ğŸ‘°ğŸ»", "ğŸ™ğŸ»", "ğŸ™ğŸ»", "ğŸ™…ğŸ»", "ğŸ™†ğŸ»", "ğŸ’ğŸ»", "ğŸ™‹ğŸ»", "ğŸ™‡ğŸ»", "ğŸ™ŒğŸ»", "ğŸ™ğŸ»", "ğŸš¶ğŸ»", "ğŸƒğŸ»", "ğŸ’ƒğŸ»", "ğŸ’ªğŸ»", "ğŸ‘ˆğŸ»", "ğŸ‘‰ğŸ»", "â˜ï¸ğŸ»", "ğŸ‘†ğŸ»", "ğŸ–•ğŸ»", "ğŸ‘‡ğŸ»", "âœŒï¸ğŸ»", "ğŸ––ğŸ»", "ğŸ¤˜ğŸ»", "ğŸ–ğŸ»", "âœŠğŸ»", "âœ‹ğŸ»", "ğŸ‘ŠğŸ»", "ğŸ‘ŒğŸ»", "ğŸ‘ğŸ»", "ğŸ‘ğŸ»", "ğŸ‘‹ğŸ»", "ğŸ‘ğŸ»", "ğŸ‘ğŸ»", "âœğŸ»", "ğŸ’…ğŸ»", "ğŸ‘‚ğŸ»", "ğŸ‘ƒğŸ»", "ğŸš£ğŸ»", "ğŸ›€ğŸ»", "ğŸ„ğŸ»", "ğŸ‡ğŸ»", "ğŸŠğŸ»", "â›¹ğŸ»", "ğŸ‹ğŸ»", "ğŸš´ğŸ»", "ğŸšµğŸ»ğŸ‘¦ğŸ¼", "ğŸ‘§ğŸ¼", "ğŸ‘¨ğŸ¼", "ğŸ‘©ğŸ¼", "ğŸ‘´ğŸ¼", "ğŸ‘µğŸ¼", "ğŸ‘¶ğŸ¼", "ğŸ‘±ğŸ¼", "ğŸ‘®ğŸ¼", "ğŸ‘²ğŸ¼", "ğŸ‘³ğŸ¼", "ğŸ‘·ğŸ¼", "ğŸ‘¸ğŸ¼", "ğŸ’‚ğŸ¼", "ğŸ…ğŸ¼", "ğŸ‘¼ğŸ¼", "ğŸ’†ğŸ¼", "ğŸ’‡ğŸ¼", "ğŸ‘°ğŸ¼", "ğŸ™ğŸ¼", "ğŸ™ğŸ¼", "ğŸ™…ğŸ¼", "ğŸ™†ğŸ¼", "ğŸ’ğŸ¼", "ğŸ™‹ğŸ¼", "ğŸ™‡ğŸ¼", "ğŸ™ŒğŸ¼", "ğŸ™ğŸ¼", "ğŸš¶ğŸ¼", "ğŸƒğŸ¼", "ğŸ’ƒğŸ¼", "ğŸ’ªğŸ¼", "ğŸ‘ˆğŸ¼", "ğŸ‘‰ğŸ¼", "â˜ï¸ğŸ¼", "ğŸ‘†ğŸ¼", "ğŸ–•ğŸ¼", "ğŸ‘‡ğŸ¼", "âœŒï¸ğŸ¼", "ğŸ––ğŸ¼", "ğŸ¤˜ğŸ¼", "ğŸ–ğŸ¼", "âœŠğŸ¼", "âœ‹ğŸ¼", "ğŸ‘ŠğŸ¼", "ğŸ‘ŒğŸ¼", "ğŸ‘ğŸ¼", "ğŸ‘ğŸ¼", "ğŸ‘‹ğŸ¼", "ğŸ‘ğŸ¼", "ğŸ‘ğŸ¼", "âœğŸ¼", "ğŸ’…ğŸ¼", "ğŸ‘‚ğŸ¼", "ğŸ‘ƒğŸ¼", "ğŸš£ğŸ¼", "ğŸ›€ğŸ¼", "ğŸ„ğŸ¼", "ğŸ‡ğŸ¼", "ğŸŠğŸ¼", "â›¹ğŸ¼", "ğŸ‹ğŸ¼", "ğŸš´ğŸ¼", "ğŸšµğŸ¼ğŸ‘¦ğŸ½", "ğŸ‘§ğŸ½", "ğŸ‘¨ğŸ½", "ğŸ‘©ğŸ½", "ğŸ‘´ğŸ½", "ğŸ‘µğŸ½", "ğŸ‘¶ğŸ½", "ğŸ‘±ğŸ½", "ğŸ‘®ğŸ½", "ğŸ‘²ğŸ½", "ğŸ‘³ğŸ½", "ğŸ‘·ğŸ½", "ğŸ‘¸ğŸ½", "ğŸ’‚ğŸ½", "ğŸ…ğŸ½", "ğŸ‘¼ğŸ½", "ğŸ’†ğŸ½", "ğŸ’‡ğŸ½", "ğŸ‘°ğŸ½", "ğŸ™ğŸ½", "ğŸ™ğŸ½", "ğŸ™…ğŸ½", "ğŸ™†ğŸ½", "ğŸ’ğŸ½", "ğŸ™‹ğŸ½", "ğŸ™‡ğŸ½", "ğŸ™ŒğŸ½", "ğŸ™ğŸ½", "ğŸš¶ğŸ½", "ğŸƒğŸ½", "ğŸ’ƒğŸ½", "ğŸ’ªğŸ½", "ğŸ‘ˆğŸ½", "ğŸ‘‰ğŸ½", "â˜ï¸ğŸ½", "ğŸ‘†ğŸ½", "ğŸ–•ğŸ½", "ğŸ‘‡ğŸ½", "âœŒï¸ğŸ½", "ğŸ––ğŸ½", "ğŸ¤˜ğŸ½", "ğŸ–ğŸ½", "âœŠğŸ½", "âœ‹ğŸ½", "ğŸ‘ŠğŸ½", "ğŸ‘ŒğŸ½", "ğŸ‘ğŸ½", "ğŸ‘ğŸ½", "ğŸ‘‹ğŸ½", "ğŸ‘ğŸ½", "ğŸ‘ğŸ½", "âœğŸ½", "ğŸ’…ğŸ½", "ğŸ‘‚ğŸ½", "ğŸ‘ƒğŸ½", "ğŸš£ğŸ½", "ğŸ›€ğŸ½", "ğŸ„ğŸ½", "ğŸ‡ğŸ½", "ğŸŠğŸ½", "â›¹ğŸ½", "ğŸ‹ğŸ½", "ğŸš´ğŸ½", "ğŸšµğŸ½ğŸ‘¦ğŸ¾", "ğŸ‘§ğŸ¾", "ğŸ‘¨ğŸ¾", "ğŸ‘©ğŸ¾", "ğŸ‘´ğŸ¾", "ğŸ‘µğŸ¾", "ğŸ‘¶ğŸ¾", "ğŸ‘±ğŸ¾", "ğŸ‘®ğŸ¾", "ğŸ‘²ğŸ¾", "ğŸ‘³ğŸ¾", "ğŸ‘·ğŸ¾", "ğŸ‘¸ğŸ¾", "ğŸ’‚ğŸ¾", "ğŸ…ğŸ¾", "ğŸ‘¼ğŸ¾", "ğŸ’†ğŸ¾", "ğŸ’‡ğŸ¾", "ğŸ‘°ğŸ¾", "ğŸ™ğŸ¾", "ğŸ™ğŸ¾", "ğŸ™…ğŸ¾", "ğŸ™†ğŸ¾", "ğŸ’ğŸ¾", "ğŸ™‹ğŸ¾", "ğŸ™‡ğŸ¾", "ğŸ™ŒğŸ¾", "ğŸ™ğŸ¾", "ğŸš¶ğŸ¾", "ğŸƒğŸ¾", "ğŸ’ƒğŸ¾", "ğŸ’ªğŸ¾", "ğŸ‘ˆğŸ¾", "ğŸ‘‰ğŸ¾", "â˜ï¸ğŸ¾", "ğŸ‘†ğŸ¾", "ğŸ–•ğŸ¾", "ğŸ‘‡ğŸ¾", "âœŒï¸ğŸ¾", "ğŸ––ğŸ¾", "ğŸ¤˜ğŸ¾", "ğŸ–ğŸ¾", "âœŠğŸ¾", "âœ‹ğŸ¾", "ğŸ‘ŠğŸ¾", "ğŸ‘ŒğŸ¾", "ğŸ‘ğŸ¾", "ğŸ‘ğŸ¾", "ğŸ‘‹ğŸ¾", "ğŸ‘ğŸ¾", "ğŸ‘ğŸ¾", "âœğŸ¾", "ğŸ’…ğŸ¾", "ğŸ‘‚ğŸ¾", "ğŸ‘ƒğŸ¾", "ğŸš£ğŸ¾", "ğŸ›€ğŸ¾", "ğŸ„ğŸ¾", "ğŸ‡ğŸ¾", "ğŸŠğŸ¾", "â›¹ğŸ¾", "ğŸ‹ğŸ¾", "ğŸš´ğŸ¾", "ğŸšµğŸ¾ğŸ‘¦ğŸ¿", "ğŸ‘§ğŸ¿", "ğŸ‘¨ğŸ¿", "ğŸ‘©ğŸ¿", "ğŸ‘´ğŸ¿", "ğŸ‘µğŸ¿", "ğŸ‘¶ğŸ¿", "ğŸ‘±ğŸ¿", "ğŸ‘®ğŸ¿", "ğŸ‘²ğŸ¿", "ğŸ‘³ğŸ¿", "ğŸ‘·ğŸ¿", "ğŸ‘¸ğŸ¿", "ğŸ’‚ğŸ¿", "ğŸ…ğŸ¿", "ğŸ‘¼ğŸ¿", "ğŸ’†ğŸ¿", "ğŸ’‡ğŸ¿", "ğŸ‘°ğŸ¿", "ğŸ™ğŸ¿", "ğŸ™ğŸ¿", "ğŸ™…ğŸ¿", "ğŸ™†ğŸ¿", "ğŸ’ğŸ¿", "ğŸ™‹ğŸ¿", "ğŸ™‡ğŸ¿", "ğŸ™ŒğŸ¿", "ğŸ™ğŸ¿", "ğŸš¶ğŸ¿", "ğŸƒğŸ¿", "ğŸ’ƒğŸ¿", "ğŸ’ªğŸ¿", "ğŸ‘ˆğŸ¿", "ğŸ‘‰ğŸ¿", "â˜ï¸ğŸ¿", "ğŸ‘†ğŸ¿", "ğŸ–•ğŸ¿", "ğŸ‘‡ğŸ¿", "âœŒï¸ğŸ¿", "ğŸ––ğŸ¿", "ğŸ¤˜ğŸ¿", "ğŸ–ğŸ¿", "âœŠğŸ¿", "âœ‹ğŸ¿", "ğŸ‘ŠğŸ¿", "ğŸ‘ŒğŸ¿", "ğŸ‘ğŸ¿", "ğŸ‘ğŸ¿", "ğŸ‘‹ğŸ¿", "ğŸ‘ğŸ¿", "ğŸ‘ğŸ¿", "âœğŸ¿", "ğŸ’…ğŸ¿", "ğŸ‘‚ğŸ¿", "ğŸ‘ƒğŸ¿", "ğŸš£ğŸ¿", "ğŸ›€ğŸ¿", "ğŸ„ğŸ¿", "ğŸ‡ğŸ¿", "ğŸŠğŸ¿", "â›¹ğŸ¿", "ğŸ‹ğŸ¿", "ğŸš´ğŸ¿", "ğŸšµğŸ¿ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ½", "ğŸ¸", "ğŸ™", "ğŸµ", "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "ğŸ’", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£", "ğŸ¥", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸŒ", "ğŸ", "ğŸœ", "ğŸ•·", "ğŸ¦‚", "ğŸ¦€", "ğŸ", "ğŸ¢", "ğŸ ", "ğŸŸ", "ğŸ¡", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸŠ", "ğŸ†", "ğŸ…", "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸª", "ğŸ«", "ğŸ˜", "ğŸ", "ğŸ", "ğŸ‘", "ğŸ", "ğŸ–", "ğŸ€", "ğŸ", "ğŸ“", "ğŸ¦ƒ", "ğŸ•Š", "ğŸ•", "ğŸ©", "ğŸˆ", "ğŸ‡", "ğŸ¿", "ğŸ¾", "ğŸ‰", "ğŸ²", "ğŸŒµ", "ğŸ„", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´", "ğŸŒ±", "ğŸŒ¿", "â˜˜", "ğŸ€", "ğŸ", "ğŸ‹", "ğŸƒ", "ğŸ‚", "ğŸ", "ğŸŒ¾", "ğŸŒº", "ğŸŒ»", "ğŸŒ¹", "ğŸŒ·", "ğŸŒ¼", "ğŸŒ¸", "ğŸ’", "ğŸ„", "ğŸŒ°", "ğŸƒ", "ğŸš", "ğŸ•¸", "ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸŒ•", "ğŸŒ–", "ğŸŒ—", "ğŸŒ˜", "ğŸŒ‘", "ğŸŒ’", "ğŸŒ“", "ğŸŒ”", "ğŸŒš", "ğŸŒ", "ğŸŒ›", "ğŸŒœ", "ğŸŒ", "ğŸŒ™", "â­ï¸", "ğŸŒŸ", "ğŸ’«", "âœ¨", "â˜„", "â˜€ï¸", "ğŸŒ¤", "â›…ï¸", "ğŸŒ¥", "ğŸŒ¦", "â˜ï¸", "ğŸŒ§", "â›ˆ", "ğŸŒ©", "âš¡ï¸", "ğŸ”¥", "ğŸ’¥", "â„ï¸", "ğŸŒ¨", "ğŸ”¥", "ğŸ’¥", "â„ï¸", "ğŸŒ¨", "â˜ƒï¸", "â›„ï¸", "ğŸŒ¬", "ğŸ’¨", "ğŸŒª", "ğŸŒ«", "â˜‚ï¸", "â˜”ï¸", "ğŸ’§", "ğŸ’¦", "ğŸŒŠğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ", "ğŸ…", "ğŸ†", "ğŸŒ¶", "ğŸŒ½", "ğŸ ", "ğŸ¯", "ğŸ", "ğŸ§€", "ğŸ—", "ğŸ–", "ğŸ¤", "ğŸ³", "ğŸ”", "ğŸŸ", "ğŸŒ­", "ğŸ•", "ğŸ", "ğŸŒ®", "ğŸŒ¯", "ğŸœ", "ğŸ²", "ğŸ¥", "ğŸ£", "ğŸ±", "ğŸ›", "ğŸ™", "ğŸš", "ğŸ˜", "ğŸ¢", "ğŸ¡", "ğŸ§", "ğŸ¨", "ğŸ¦", "ğŸ°", "ğŸ‚", "ğŸ®", "ğŸ¬", "ğŸ­", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸº", "ğŸ»", "ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸ¾", "ğŸ¶", "ğŸµ", "â˜•ï¸", "ğŸ¼", "ğŸ´", "ğŸ½âš½ï¸", "ğŸ€", "ğŸˆ", "âš¾ï¸", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ±", "â›³ï¸", "ğŸŒ", "ğŸ“", "ğŸ¸", "ğŸ’", "ğŸ‘", "ğŸ", "ğŸ¿", "â›·", "ğŸ‚", "â›¸", "ğŸ¹", "ğŸ£", "ğŸš£", "ğŸŠ", "ğŸ„", "ğŸ›€", "â›¹", "ğŸ‹", "ğŸš´", "ğŸšµ", "ğŸ‡", "ğŸ•´", "ğŸ†", "ğŸ½", "ğŸ…", "ğŸ–", "ğŸ—", "ğŸµ", "ğŸ«", "ğŸŸ", "ğŸ­", "ğŸ¨", "ğŸª", "ğŸ¤", "ğŸ§", "ğŸ¼", "ğŸ¹", "ğŸ·", "ğŸº", "ğŸ¸", "ğŸ»", "ğŸ¬", "ğŸ®", "ğŸ‘¾", "ğŸ¯", "ğŸ²", "ğŸ°", "ğŸ³ğŸš—", "ğŸš•", "ğŸš™", "ğŸšŒ", "ğŸš", "ğŸ", "ğŸš“", "ğŸš‘", "ğŸš’", "ğŸš", "ğŸšš", "ğŸš›", "ğŸšœ", "ğŸ", "ğŸš²", "ğŸš¨", "ğŸš”", "ğŸš", "ğŸš˜", "ğŸš–", "ğŸš¡", "ğŸš ", "ğŸšŸ", "ğŸšƒ", "ğŸš‹", "ğŸš", "ğŸš„", "ğŸš…", "ğŸšˆ", "ğŸš", "ğŸš‚", "ğŸš†", "ğŸš‡", "ğŸšŠ", "ğŸš‰", "ğŸš", "ğŸ›©", "âœˆï¸", "ğŸ›«", "ğŸ›¬", "â›µï¸", "ğŸ›¥", "ğŸš¤", "â›´", "ğŸ›³", "ğŸš€", "ğŸ›°", "ğŸ’º", "âš“ï¸", "ğŸš§", "â›½ï¸", "ğŸš", "ğŸš¦", "ğŸš¥", "ğŸ", "ğŸš¢", "ğŸ¡", "ğŸ¢", "ğŸ ", "ğŸ—", "ğŸŒ", "ğŸ—¼", "ğŸ­", "â›²ï¸", "ğŸ‘", "â›°", "ğŸ”", "ğŸ—»", "ğŸŒ‹", "ğŸ—¾", "ğŸ•", "â›ºï¸", "ğŸ", "ğŸ›£", "ğŸ›¤", "ğŸŒ…", "ğŸŒ„", "ğŸœ", "ğŸ–", "ğŸ", "ğŸŒ‡", "ğŸŒ†", "ğŸ™", "ğŸŒƒ", "ğŸŒ‰", "ğŸŒŒ", "ğŸŒ ", "ğŸ‡", "ğŸ†", "ğŸŒˆ", "ğŸ˜", "ğŸ°", "ğŸ¯", "ğŸŸ", "ğŸ—½", "ğŸ ", "ğŸ¡", "ğŸš", "ğŸ¢", "ğŸ¬", "ğŸ£", "ğŸ¤", "ğŸ¥", "ğŸ¦", "ğŸ¨", "ğŸª", "ğŸ«", "ğŸ©", "ğŸ’’", "ğŸ›", "â›ªï¸", "ğŸ•Œ", "ğŸ•", "ğŸ•‹", "â›©âŒšï¸", "ğŸ“±", "ğŸ“²", "ğŸ’»", "âŒ¨", "ğŸ–¥", "ğŸ–¨", "ğŸ–±", "ğŸ–²", "ğŸ•¹", "ğŸ—œ", "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹", "ğŸ¥", "ğŸ“½", "ğŸ", "ğŸ“", "â˜ï¸", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º", "ğŸ“»", "ğŸ™", "ğŸš", "ğŸ›", "â±", "â²", "â°", "ğŸ•°", "â³", "âŒ›ï¸", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦", "ğŸ•¯", "ğŸ—‘", "ğŸ›¢", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·", "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–", "ğŸ”§", "ğŸ”¨", "âš’", "ğŸ› ", "â›", "ğŸ”©", "âš™", "â›“", "ğŸ”«", "ğŸ’£", "ğŸ”ª", "ğŸ—¡", "âš”", "ğŸ›¡", "ğŸš¬", "â˜ ", "âš°", "âš±", "ğŸº", "ğŸ”®", "ğŸ“¿", "ğŸ’ˆ", "âš—", "ğŸ”­", "ğŸ”¬", "ğŸ•³", "ğŸ’Š", "ğŸ’‰", "ğŸŒ¡", "ğŸ·", "ğŸ”–", "ğŸš½", "ğŸš¿", "ğŸ›", "ğŸ”‘", "ğŸ—", "ğŸ›‹", "ğŸ›Œ", "ğŸ›", "ğŸšª", "ğŸ›", "ğŸ–¼", "ğŸ—º", "â›±", "ğŸ—¿", "ğŸ›", "ğŸˆ", "ğŸ", "ğŸ€", "ğŸ", "ğŸŠ", "ğŸ‰", "ğŸ", "ğŸ", "ğŸŒ", "ğŸ®", "âœ‰ï¸", "ğŸ“©", "ğŸ“¨", "ğŸ“§", "ğŸ’Œ", "ğŸ“®", "ğŸ“ª", "ğŸ“«", "ğŸ“¬", "ğŸ“­", "ğŸ“¦", "ğŸ“¯", "ğŸ“¥", "ğŸ“¤", "ğŸ“œ", "ğŸ“ƒ", "ğŸ“‘", "ğŸ“Š", "ğŸ“ˆ", "ğŸ“‰", "ğŸ“„", "ğŸ“…", "ğŸ“†", "ğŸ—“", "ğŸ“‡", "ğŸ—ƒ", "ğŸ—³", "ğŸ—„", "ğŸ“‹", "ğŸ—’", "ğŸ“", "ğŸ“‚", "ğŸ—‚", "ğŸ—", "ğŸ“°", "ğŸ““", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ“”", "ğŸ“’", "ğŸ“š", "ğŸ“–", "ğŸ”—", "ğŸ“", "ğŸ–‡", "âœ‚ï¸", "ğŸ“", "ğŸ“", "ğŸ“Œ", "ğŸ“", "ğŸš©", "ğŸ³", "ğŸ´", "ğŸ”", "ğŸ”’", "ğŸ”“", "ğŸ”", "ğŸ–Š", "ğŸ–Š", "ğŸ–‹", "âœ’ï¸", "ğŸ“", "âœï¸", "ğŸ–", "ğŸ–Œ", "ğŸ”", "ğŸ”â¤ï¸", "ğŸ’›", "ğŸ’™", "ğŸ’œ", "ğŸ’”", "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–", "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®", "âœï¸", "â˜ª", "ğŸ•‰", "â˜¸", "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦", "ğŸ›", "â›", "â™ˆï¸", "â™‰ï¸", "â™Šï¸", "â™‹ï¸", "â™Œï¸", "â™ï¸", "â™ï¸", "â™ï¸", "â™ï¸", "â™‘ï¸", "â™’ï¸", "â™“ï¸", "ğŸ†”", "âš›", "ğŸˆ³", "ğŸˆ¹", "â˜¢", "â˜£", "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆšï¸", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·ï¸", "âœ´ï¸", "ğŸ†š", "ğŸ‰‘", "ğŸ’®", "ğŸ‰", "ãŠ™ï¸", "ãŠ—ï¸", "ğŸˆ´", "ğŸˆµ", "ğŸˆ²", "ğŸ…°ï¸", "ğŸ…±ï¸", "ğŸ†", "ğŸ†‘", "ğŸ…¾ï¸", "ğŸ†˜", "â›”ï¸", "ğŸ“›", "ğŸš«", "âŒ", "â­•ï¸", "ğŸ’¢", "â™¨ï¸", "ğŸš·", "ğŸš¯", "ğŸš³", "ğŸš±", "ğŸ”", "ğŸ“µ", "â—ï¸", "â•", "â“", "â”", "â€¼ï¸", "â‰ï¸", "ğŸ’¯", "ğŸ”…", "ğŸ”†", "ğŸ”±", "âšœ", "ã€½ï¸", "âš ï¸", "ğŸš¸", "ğŸ”°", "â™»ï¸", "ğŸˆ¯ï¸", "ğŸ’¹", "â‡ï¸", "âœ³ï¸", "â", "âœ…", "ğŸ’ ", "ğŸŒ€", "â¿", "ğŸŒ", "â“‚ï¸", "ğŸ§", "ğŸˆ‚ï¸", "ğŸ›‚", "ğŸ›ƒ", "ğŸ›„", "ğŸ›…", "â™¿ï¸", "ğŸš­", "ğŸš¾", "ğŸ…¿ï¸", "ğŸš°", "ğŸš¹", "ğŸšº", "ğŸš¼", "ğŸš»", "ğŸš®", "ğŸ¦", "ğŸ“¶", "ğŸˆ", "ğŸ†–", "ğŸ†—", "ğŸ†™", "ğŸ†’", "ğŸ†•", "ğŸ†“", "0ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "4ï¸âƒ£", "5ï¸âƒ£", "6ï¸âƒ£", "7ï¸âƒ£", "8ï¸âƒ£", "9ï¸âƒ£", "ğŸ”Ÿ", "ğŸ”¢", "â–¶ï¸", "â¸", "â¯", "â¹", "âº", "â­", "â®", "â©", "âª", "ğŸ”€", "ğŸ”", "ğŸ”‚", "â—€ï¸", "ğŸ”¼", "ğŸ”½", "â«", "â¬", "â¡ï¸", "â¬…ï¸", "â¬†ï¸", "â¬‡ï¸", "â†—ï¸", "â†˜ï¸", "â†™ï¸", "â†–ï¸", "â†•ï¸", "â†”ï¸", "ğŸ”„", "â†ªï¸", "â†©ï¸", "â¤´ï¸", "â¤µï¸", "#ï¸âƒ£", "*ï¸âƒ£", "â„¹ï¸", "ğŸ”¤", "ğŸ”¡", "ğŸ” ", "ğŸ”£", "ğŸµ", "ğŸ¶", "ã€°ï¸", "â°", "âœ”ï¸", "ğŸ”ƒ", "â•", "â–", "â—", "âœ–ï¸", "ğŸ’²", "ğŸ’±", "Â©ï¸", "Â®ï¸", "â„¢ï¸", "ğŸ”š", "ğŸ”™", "ğŸ”›", "ğŸ”", "ğŸ”œ", "â˜‘ï¸", "ğŸ”˜", "âšªï¸", "âš«ï¸", "ğŸ”´", "ğŸ”µ", "ğŸ”¸", "ğŸ”¹", "ğŸ”¶", "ğŸ”·", "ğŸ”º", "â–ªï¸", "â–«ï¸", "â¬›ï¸", "â¬œï¸", "ğŸ”»", "â—¼ï¸", "â—»ï¸", "â—¾ï¸", "â—½ï¸", "ğŸ”²", "ğŸ”³", "ğŸ”ˆ", "ğŸ”‰", "ğŸ”Š", "ğŸ”‡", "ğŸ“£", "ğŸ“¢", "ğŸ””", "ğŸ”•", "ğŸƒ", "ğŸ€„ï¸", "â™ ï¸", "â™£ï¸", "â™¥ï¸", "â™¦ï¸", "ğŸ´", "ğŸ‘â€ğŸ—¨", "ğŸ’­", "ğŸ—¯", "ğŸ’¬", "ğŸ•", "ğŸ•‘", "ğŸ•’", "ğŸ•“", "ğŸ•”", "ğŸ••", "ğŸ•–", "ğŸ•—", "ğŸ•˜", "ğŸ•™", "ğŸ•š", "ğŸ•›", "ğŸ•œ", "ğŸ•", "ğŸ•", "ğŸ•Ÿ", "ğŸ• ", "ğŸ•¡", "ğŸ•¢", "ğŸ•£", "ğŸ•¤", "ğŸ•¥", "ğŸ•¦", "ğŸ•§", "ğŸ¤£", "ğŸ¤ ", "ğŸ¤¡", "ğŸ¤¥", "ğŸ¤¤", "ğŸ¤¢", "ğŸ¤§", "ğŸ¤´", "ğŸ¤¶", "ğŸ¤µ", "ğŸ¤·", "ğŸ¤¦", "ğŸ¤°", "ğŸ•º", "ğŸ¤³", "ğŸ¤", "ğŸ¤™", "ğŸ¤›", "ğŸ¤œ", "ğŸ¤š", "ğŸ¤", "ğŸ–¤", "ğŸ¦", "ğŸ¦Š", "ğŸ¦Œ", "ğŸ¦", "ğŸ¦‡", "ğŸ¦…", "ğŸ¦†", "ğŸ¦‰", "ğŸ¦", "ğŸ¦ˆ", "ğŸ¦", "ğŸ¦‘", "ğŸ¦‹", "ğŸ¥€", "ğŸ¥", "ğŸ¥‘", "ğŸ¥”", "ğŸ¥•", "ğŸ¥’", "ğŸ¥œ", "ğŸ¥", "ğŸ¥–", "ğŸ¥", "ğŸ¥“", "ğŸ¥™", "ğŸ¥š", "ğŸ¥˜", "ğŸ¥—", "ğŸ¥›", "ğŸ¥‚", "ğŸ¥ƒ", "ğŸ¥„", "ğŸ›‘", "ğŸ›´", "ğŸ›µ", "ğŸ›¶", "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰", "ğŸ¥Š", "ğŸ¥‹", "ğŸ¤¸", "ğŸ¤¼", "ğŸ¤½", "ğŸ¤¾", "ğŸ¤º", "ğŸ¥…", "ğŸ¤¹", "ğŸ¥", "ğŸ›’", "â˜ºï¸", "â˜¹", "â˜ï¸", "âœŒï¸", "âœï¸", "â¤ï¸", "â£ï¸", "â˜ ", "â™¨ï¸", "âœˆï¸", "âŒ›", "âŒš", "â™ˆ", "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™", "â™‘", "â™’", "â™“", "â˜€ï¸", "â˜ï¸", "â˜‚ï¸", "â„ï¸", "â›„ï¸", "â˜„", "â™ ï¸", "â™¥ï¸", "â™¦ï¸", "â™£ï¸", "â–¶ï¸", "â—€ï¸", "â˜ï¸", "âŒ¨", "âœ‰ï¸", "âœï¸", "âœ’ï¸", "âœ‚ï¸", "â†—ï¸", "â¡ï¸", "â†˜ï¸", "â†™ï¸", "â†–ï¸", "â†•ï¸", "â†”ï¸", "â†©ï¸", "â†ªï¸", "âœ¡ï¸", "â˜¸", "â˜¯ï¸", "âœï¸", "â˜¦", "â˜ª", "â˜®", "â˜¢", "â˜£", "â˜‘ï¸", "âœ”ï¸", "âœ–ï¸", "âœ³ï¸", "âœ´ï¸", "â‡ï¸", "â€¼ï¸", "Â©ï¸", "Â®ï¸", "â„¢ï¸", "â“‚ï¸", "â–ªï¸", "â–«ï¸", "#âƒ£ï¸", "*ï¸âƒ£", "0âƒ£ï¸", "1âƒ£ï¸", "2âƒ£ï¸", "3âƒ£ï¸", "4âƒ£ï¸", "5âƒ£ï¸", "6âƒ£ï¸", "7âƒ£ï¸", "8âƒ£ï¸", "9âƒ£ï¸", "â‰ï¸", "â„¹ï¸", "â¤´ï¸", "â¤µï¸", "â™»ï¸", "â—»ï¸", "â—¼ï¸", "â—½", "â—¾", "â˜•", "âš ï¸", "â˜”", "â", "â¬†ï¸", "â¬‡ï¸", "â¬…ï¸", "âš¡", "â˜˜", "âš“", "â™¿", "âš’", "âš™", "âš—", "âš–", "âš”", "âš°", "âš±", "âšœ", "âš›", "âšª", "âš«", "ğŸ€„", "â­", "â¬›", "â¬œ", "â›‘", "â›°", "â›ª", "â›²", "â›º", "â›½", "â›µ", "â›´", "â›”", "â›…", "â›ˆ", "â›±", "â›„", "âš½", "âš¾ï¸", "â›³", "â›¸", "â›·", "â›¹", "â›", "â›“", "â›©", "â­•", "â—", "ğŸ…¿ï¸", "â¦", "â™•", "â™›", "â™”", "â™–", "â™œ", "â˜¾", "â†’", "â‡’", "âŸ¹", "â‡¨", "â‡°", "â©", "âª", "â«", "â¬", "â­", "â®", "â¯", "â²", "â³", "âµ", "â¸", "â»", "âº", "â¼", "â½", "â˜œ", "â˜Ÿ", "â¹", "â·", "â†¶", "â†·", "âœ†", "âŒ˜", "â‹", "â", "â", "âˆ", "âŒ", "âŸ", "â¥", "ãƒ„", "áƒ¦", "â˜»", ">:(", ">:O", "<3", "(^^^)", "(y)", "-_-", "3:)", "8-)", "8|", ":'(", ":(", ":-(", ":)", ":-)", ":*", ":/", ":3", ":D", ":-D", ":O", ":P", ":poop:", ":putnam:", ":v", ":|]", ";)", "<(\")", "^_^", "o.O", "O:)"
]


def aggregator_smileys(msgs):
    """
    Counts smileys, both unicode and ASCII
    """
    count = {smiley: sum([m["text"].count(smiley) for m in msgs]) for smiley in smileys}
    total = sum(count.values())
    return {
        'smiley_count': {smiley: count[smiley] for smiley in smileys if count[smiley] > 0},
        'total_smileys': total,
        'smileys_per_message': total / len(msgs)
    }


def aggregator_active_days(msgs):
    """
    Finds the day of the first and last message detected
    """
    date_first_message = msgs[-1]['date']
    date_last_message = msgs[0]['date']
    return {
        'date_first_message': date_first_message,
        'date_last_message': date_last_message
    }

"""
DUAL AGGREGATORS
Just like regual aggregators, but called with mixed "me" and "other" messages.
"""

conv_delay = 600


def dual_aggregator_conversations(msgs):
    """
    Breaks messages into "conversations" (blocks of messages with the maximum delay lower than conv_delay)
    This makes computing avg_message_delay much more accurate
    """
    rmsgs = list(reversed(msgs))
    conversations_count = 0
    conversations_time = 0
    start = rmsgs[0]
    last = start
    for i in range(1, len(rmsgs)):
        if rmsgs[i]['date'] > (last['date'] + conv_delay):
            if start != last:  # Don't count 1-message conversations
                conversations_count += 1
                conversations_time += last['date'] - start['date']
            start = rmsgs[i]
            last = start
        else:
            last = rmsgs[i]
    return {
        'conversations_count': conversations_count,
        'total_conversations_time': conversations_time,
        'avg_conversation_time': conversations_time / conversations_count,
        'avg_message_delay': conversations_time / len(msgs)
    }


def dual_aggregator_questions(msgs):
    """
    Dectects questions and counts the average time to respond
    """
    rmsgs = list(reversed(msgs))
    last_question = None
    question_waiting_time = [0, 0]
    questions_count = [0, 0]
    for i in range(len(rmsgs)):
        if last_question is not None and last_question['by_me'] != rmsgs[i]['by_me']:
            question_waiting_time[+rmsgs[i]['by_me']] += min(rmsgs[i]['date'] - last_question['date'], 3600*12)
            questions_count[+rmsgs[i]['by_me']] += 1
        last_question = rmsgs[i] if rmsgs[i]['text'].endswith("?") else None
    return {
        'avg_response_delay_other': question_waiting_time[0] / questions_count[0],
        'avg_response_delay_me': question_waiting_time[1] / questions_count[1]
    }

"""
POSTPROCESSORS
They are called at the very last, on the resulting "data" object. They may edit it as they please.
"""


def postprocessor_message_ratio(data):
    for k, d in data.items():
        if k.startswith("_"):
            continue
        d['msg_ratio_me'] = d['msg_count_me'] / (d['msg_count_other'] + d['msg_count_me'])
        d['word_ratio_me'] = d['word_count_me'] / (d['word_count_other'] + d['word_count_me'])
        d['char_ratio_me'] = d['char_count_me'] / (d['char_count_other'] + d['char_count_me'])


# This one is cool for manual analysis, but doesn't really make sense and breaks plotting
"""
def postprocessor_records(data):
    firstitem = next(iter(data.values()))
    disciplines = [k for k in firstitem.keys() if isinstance(firstitem[k], (int, float))]
    maximums = {d: None for d in disciplines}
    minimums = {d: None for d in disciplines}
    for k, d in data.items():
        if k.startswith("_"):
            continue
        for discipline in disciplines:
            if maximums[discipline] is None or d[discipline] > data[maximums[discipline]][discipline]:
                maximums[discipline] = k
            if minimums[discipline] is None or d[discipline] < data[minimums[discipline]][discipline]:
                minimums[discipline] = k
    data['_RECORDS'] = {'max': maximums, 'min': minimums}
"""
